{% comment %}
  언어별로 포스트 분류 로직 (명확한 카테고리 분류)
  매개변수:
  - language: 'ko' 또는 'en'
{% endcomment %}

{% assign all_posts = site.posts %}
{% assign language_posts = "" | split: "" %}

{% comment %} 언어별 포스트 필터링 {% endcomment %}
{% for post in all_posts %}
  {% if language == 'ko' %}
    {% comment %} 한국어 포스트 조건을 명확히 괄호로 구분 {% endcomment %}
    {% if (post.lang == 'ko') or (post.lang == nil and (post.categories contains 'korean' or post.categories contains 'korean-posts')) or (post.lang != 'en' and post.categories contains 'tech-news-analysis') %}
      {% assign language_posts = language_posts | push: post %}
    {% endif %}
  {% elsif language == 'en' %}
    {% if (post.lang == 'en') or (post.lang == nil and post.categories contains 'english') or (post.lang != 'ko' and post.categories contains 'tech-news-analysis') %}
      {% assign language_posts = language_posts | push: post %}
    {% endif %}
  {% endif %}
{% endfor %}

{% comment %} 명확히 분류된 카테고리별 분류 {% endcomment %}
{% assign tech_trends_posts = "" | split: "" %}
{% assign automation_posts = "" | split: "" %}
{% assign ai_research_posts = "" | split: "" %}
{% assign ai_practice_posts = "" | split: "" %}
{% assign programming_posts = "" | split: "" %}
{% assign study_posts = "" | split: "" %}
{% assign project_posts = "" | split: "" %}
{% assign startup_posts = "" | split: "" %}
{% assign other_posts = "" | split: "" %}

{% comment %} 디버깅 정보 출력 (개발 환경에서만) {% endcomment %}
{% if jekyll.environment != 'production' %}
<!-- DEBUG: 총 {{ all_posts.size }}개 포스트 중 {{ language_posts.size }}개가 {{ language }} 언어로 분류됨 -->
{% for post in language_posts limit:5 %}
<!-- DEBUG: "{{ post.title }}" - lang: "{{ post.lang }}", categories: [{{ post.categories | join: ', ' }}] -->
{% endfor %}
{% endif %}

{% for post in language_posts %}
  {% assign is_categorized = false %}
  
  {% comment %} 1. 기술트렌드 (최우선 - 기존 tech-news-analysis 및 tech-trends) {% endcomment %}
  {% if post.categories contains 'tech-trends' or post.categories contains 'tech-news-analysis' or post.categories contains 'news-analysis' or post.categories contains 'industry-analysis' or post.categories contains 'market-trends' %}
    {% assign tech_trends_posts = tech_trends_posts | push: post %}
    {% assign is_categorized = true %}
  {% endif %}
  
  {% comment %} 2. 자동화 {% endcomment %}
  {% unless is_categorized %}
    {% if post.categories contains 'mcp' or post.categories contains 'automation' or post.categories contains 'jekyll' or post.categories contains 'github-actions' %}
      {% assign automation_posts = automation_posts | push: post %}
      {% assign is_categorized = true %}
    {% endif %}
  {% endunless %}
  
  {% comment %} 3. AI 연구 (이론, 논문, 연구) {% endcomment %}
  {% unless is_categorized %}
    {% if post.categories contains 'ai-research' or post.categories contains 'machine-learning-theory' or post.categories contains 'deep-learning-theory' or post.categories contains 'ai-theory' or post.categories contains 'ai-papers' %}
      {% assign ai_research_posts = ai_research_posts | push: post %}
      {% assign is_categorized = true %}
    {% endif %}
  {% endunless %}
  
  {% comment %} 4. AI 실습 (구현, 튜토리얼, 실습) {% endcomment %}
  {% unless is_categorized %}
    {% if post.categories contains 'ai-practice' or post.categories contains 'ai-tutorial' or post.categories contains 'model-implementation' or post.categories contains 'ai-coding' %}
      {% assign ai_practice_posts = ai_practice_posts | push: post %}
      {% assign is_categorized = true %}
    {% endif %}
  {% endunless %}
  
  {% comment %} 5. 일반적인 AI 포스트 (제목 기반 실습으로 분류) {% endcomment %}
  {% unless is_categorized %}
    {% if post.categories contains 'ai' or post.title contains 'AI' or post.title contains '인공지능' or post.title contains 'Artificial Intelligence' %}
      {% assign ai_practice_posts = ai_practice_posts | push: post %}
      {% assign is_categorized = true %}
    {% endif %}
  {% endunless %}
  
  {% comment %} 6. 프로그래밍 (기존 tech 카테고리를 programming으로 변환) {% endcomment %}
  {% unless is_categorized %}
    {% if post.categories contains 'programming' or post.categories contains 'tech' or post.categories contains 'coding' or post.categories contains 'development' or post.categories contains 'software-engineering' %}
      {% assign programming_posts = programming_posts | push: post %}
      {% assign is_categorized = true %}
    {% endif %}
  {% endunless %}
  
  {% comment %} 7. 학습 {% endcomment %}
  {% unless is_categorized %}
    {% if post.categories contains 'study' or post.categories contains 'learning' or post.categories contains 'education' or post.categories contains 'computer-science' %}
      {% assign study_posts = study_posts | push: post %}
      {% assign is_categorized = true %}
    {% endif %}
  {% endunless %}
  
  {% comment %} 8. 프로젝트 {% endcomment %}
  {% unless is_categorized %}
    {% if post.categories contains 'project' or post.categories contains 'portfolio' or post.categories contains 'personal-project' %}
      {% assign project_posts = project_posts | push: post %}
      {% assign is_categorized = true %}
    {% endif %}
  {% endunless %}
  
  {% comment %} 9. 창업 {% endcomment %}
  {% unless is_categorized %}
    {% if post.categories contains 'startup' or post.categories contains 'business' or post.categories contains 'entrepreneurship' %}
      {% assign startup_posts = startup_posts | push: post %}
      {% assign is_categorized = true %}
    {% endif %}
  {% endunless %}
  
  {% comment %} 10. 기타 (분류되지 않은 모든 포스트) - korean-posts도 여기에 포함 {% endcomment %}
  {% unless is_categorized %}
    {% assign other_posts = other_posts | push: post %}
  {% endunless %}
{% endfor %}

{% comment %} 디버깅 정보 출력 (개발 환경에서만) {% endcomment %}
{% if jekyll.environment != 'production' %}
<!-- DEBUG 카테고리별 포스트 수:
  tech_trends: {{ tech_trends_posts.size }}
  automation: {{ automation_posts.size }}
  ai_research: {{ ai_research_posts.size }}
  ai_practice: {{ ai_practice_posts.size }}
  programming: {{ programming_posts.size }}
  study: {{ study_posts.size }}
  project: {{ project_posts.size }}
  startup: {{ startup_posts.size }}
  other: {{ other_posts.size }}
  총계: {{ tech_trends_posts.size | plus: automation_posts.size | plus: ai_research_posts.size | plus: ai_practice_posts.size | plus: programming_posts.size | plus: study_posts.size | plus: project_posts.size | plus: startup_posts.size | plus: other_posts.size }}
-->
{% if other_posts.size > 0 %}
  {% for post in other_posts limit:3 %}
<!-- DEBUG 기타 포스트: "{{ post.title }}" - categories: [{{ post.categories | join: ', ' }}] -->
  {% endfor %}
{% endif %}
{% endif %}
